From Phind:

Q: How to integrate betterstack with Morgan and Winston logs in an express app?

A: To integrate BetterStack with Morgan and Winston logs in an Express app without using TypeScript, you can follow these steps:

Step 1: Install Required Dependencies
First, install the necessary packages:

npm install express morgan winston @logtail/node @logtail/winston
Step 2: Set Up Winston Logger
Create a logger.js file to set up the Winston logger:

const winston = require('winston');
const { Logtail } = require('@logtail/node');
const { LogtailTransport } = require('@logtail/winston');

// Initialize Logtail
const logtail = new Logtail('YOUR_BETTERSTACK_SOURCE_TOKEN');

module.exports = winston.createLogger({
  level: 'http',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.Console(),
    new LogtailTransport(logtail)
  ]
});
Replace 'YOUR_BETTERSTACK_SOURCE_TOKEN' with your actual BetterStack source token.

Step 3: Set Up Morgan Middleware
Create a morgan.js file to set up the Morgan middleware:

const morgan = require('morgan');

module.exports = morgan(
  ':method :url :status :res[content-length] - :response-time ms',
  {
    stream: {
      write: (message) => {
        const data = JSON.parse(message);
        const logger = require('./logger');
        logger.http(data);
      },
    },
  }
);
Step 4: Create Express App
Create an app.js file to set up your Express app:

const express = require('express');
const morganMiddleware = require('./morgan');
const logger = require('./logger');

const app = express();
app.use(express.json());
app.use(morganMiddleware);

// Example route
app.get('/', (req, res) => {
  res.send('Hello World!');
});

// Error handling
app.use((err, req, res, next) => {
  logger.error(err.stack);
  res.status(500).send('Something broke!');
});

app.listen(3000, () => {
  console.log('App listening on port 3000');
});
Step 5: Run the Application
Finally, run your application using:

node app.js

Key Points to Consider:
Make sure to replace 'YOUR_BETTERSTACK_SOURCE_TOKEN' with your actual BetterStack source token.
The morganMiddleware is configured to use the Winston logger for logging HTTP requests.
All logs will be sent to both the console and BetterStack.
You can adjust the log levels and formats according to your needs.
Summary and Best Practices:
This setup integrates Morgan and Winston with BetterStack logging in an Express app. It follows these best practices:

Centralized logging: Using Winston allows for easy configuration of multiple transports.
Modular structure: Separating concerns into different files improves maintainability.
Error handling: Implementing global error handling ensures consistent error reporting.
Environment variables: While not used here, you can easily integrate environment variables for configurations like port numbers.
By following these steps, you've successfully integrated BetterStack with Morgan and Winston logs in your Express app, providing a robust logging solution for your application.
