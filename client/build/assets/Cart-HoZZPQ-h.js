import{a as D,j as e,R as V,u as Y,r as h,d4 as U,B as n,G as p,c as u,T as i,p as re,I as T,dq as oe,ds as j,aN as P,A as ae,e as ce,n as le,d3 as de,b as xe,bf as W,dt as G,bd as q,bs as F,L as M,i as he}from"./index-RKOwH3L5.js";import{C as N,a as Q}from"./CardContent-DibvDDMS.js";import{D as ue}from"./Divider-CCWPHBZV.js";import{b as pe,j as me,S as ye,c as je}from"./Select-HLbkRNVN.js";import{C as $}from"./Checkbox-FwaULwe1.js";const ge=D(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),fe=D(e.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove"),ve=D(e.jsx("path",{d:"M3 15h18v-2H3zm0 4h18v-2H3zm0-8h18V9H3zm0-6v2h18V5z"}),"Reorder"),_=({item:o,quantity:v,onQuantityChange:y,onRemove:b})=>{const{t}=Y(),[d,g]=h.useState(v??1),[r,C]=h.useState(o.price*d),{md:l}=U(),S=()=>{const c=d+1;g(c),C(o.price*c),y&&y(o.id,c)},w=()=>{if(d>1){const c=d-1;g(c),C(o.price*c),y&&y(o.id,c)}},I=()=>{b&&b(o.id)};return e.jsx(n,{sx:{margin:"0 auto",mb:.5},children:e.jsxs(p,{container:!0,spacing:1.5,children:[e.jsx(p,{item:!0,xs:3,sx:{gridRow:"span 2",height:"100%"},children:e.jsx(n,{component:"img",src:`${u.siteUrl}${u.images.publicPath}/${o.imageName}`,alt:"Product",sx:{width:"100%",objectFit:"cover",borderRadius:1,mt:1}})}),e.jsx(p,{item:!0,xs:7,children:e.jsxs(n,{sx:{height:"100%",lineHeight:2},children:[e.jsx(i,{variant:l?"body2":"body1",lineHeight:1.5,fontWeight:"bold",children:e.jsx(n,{component:"span",sx:{color:"text.secondary"},children:o.title})}),e.jsxs(i,{variant:l?"subtitle1":"body2",sx:{lineHeight:1.5,display:"flex",alignItems:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},children:[e.jsxs(n,{component:"span",sx:{color:"text.secondary",opacity:.5},children:[t("Description"),":"]}),e.jsx(re,{title:o.description,children:e.jsx(n,{component:"span",sx:{color:"text.secondary",marginLeft:1,overflow:"hidden",textOverflow:"ellipsis"},children:o.description})})]}),e.jsxs(i,{variant:l?"subtitle1":"body2",lineHeight:1.5,children:[e.jsxs(n,{component:"span",sx:{color:"text.secondary",opacity:.5},children:[o.attribute1key,":"]}),e.jsx(n,{component:"span",sx:{color:"text.secondary",marginLeft:1},children:o.attribute1value})]}),e.jsxs(i,{variant:l?"subtitle1":"body2",lineHeight:1.5,children:[e.jsxs(n,{component:"span",sx:{color:"text.secondary",opacity:.5},children:[o.attribute2key,":"]}),e.jsx(n,{component:"span",sx:{color:"text.secondary",marginLeft:1},children:o.attribute2value})]}),e.jsx(n,{sx:{margin:0,padding:0,mb:l?-1.2:-1}})," ",e.jsxs(i,{variant:l?"subtitle1":"body2",lineHeight:1.5,sx:{color:"text.secondary",display:"inline-flex",alignItems:"center",gap:2},children:[e.jsxs(n,{component:"span",sx:{color:"text.secondary",opacity:.5,whiteSpace:"nowrap"},children:[t("Quantity"),":"]}),e.jsxs(n,{component:"span",sx:{color:"text.secondary",display:"inline-flex",alignItems:"center",gap:.5},children:[e.jsx(T,{size:"small",onClick:w,disabled:d<=1,fontSize:"inherit",sx:{fontSize:12,border:"1px solid #ddd",borderRadius:"50%",width:18,height:18,padding:0},children:e.jsx(fe,{sx:{fontSize:16}})}),e.jsx(n,{component:"span",sx:{minWidth:24,textAlign:"center",fontSize:"1rem"},children:d}),e.jsx(T,{size:"small",onClick:S,sx:{opacity:1,border:"1px solid #ddd",borderRadius:"50%",width:18,height:18,padding:0},children:e.jsx(ge,{sx:{fontSize:16}})})]})]})]})}),e.jsx(p,{item:!0,xs:2,children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},children:[e.jsx(n,{sx:{textAlign:"right"},children:e.jsx(T,{size:"small",onClick:I,children:e.jsx(oe,{})})}),e.jsx(i,{variant:l?"subtitle1":"body1",lineHeight:1.5,sx:{mb:.6,color:"text.secondary",textAlign:"right",whiteSpace:"nowrap"},children:j(r,o.currency)})]})})]})})};_.propTypes={item:P.object,quantity:P.number};const be=V.memo(_),J=o=>{var E,O,L;const{auth:v,isLoggedIn:y,updateSignedInUserPreferences:b}=h.useContext(ae),{t}=Y(),{showSnackbar:d}=ce(),{showDialog:g}=le(),{cart:r,emptyCartItems:C,setCartProperty:l,removeItemFromCart:S,cartItemsQuantity:w,setItemQuantity:I}=de(),[c,H]=h.useState(!1),[K,X]=h.useState((r==null?void 0:r.acceptToReceiveOffersEmails)??!1),[x,Z]=h.useState(u.ecommerce.delivery.methods.find(s=>s.code===(r==null?void 0:r.deliveryCode))??{code:"-"}),[R,ee]=h.useState(0),{md:z}=U(),A=xe(),f=u.currencies[u.currency];console.log("CART PROPS:",o),console.log("CART:",r),console.log("DELIVERY:",x);const te=s=>{Z(u.ecommerce.delivery.methods.find(a=>a.code===s.target.value)),l("deliveryCode",s.target.value),H({...c,delivery:!1})},se=s=>{l("isGift",s.target.value==="on")},ne=s=>{X(s.target.checked),l("acceptToReceiveOffersEmails",s.target.checked)};h.useEffect(()=>{var a;const s=(a=r==null?void 0:r.items)==null?void 0:a.reduce((m,k)=>m+k.price*(k.quantity||1),0);ee(s)},[r]);const ie=async()=>{var a,m;if(x.code==="-"){H({...c,delivery:!0}),d(t("Please choose a delivery method"),"warning");return}const s=await he("post","/payment/createCheckoutSession",{cart:r});if(console.log("*** createCheckoutSession result:",s),s.err)d(s.message,"error"),console.error("createCheckoutSession error:",s);else{if(s.user&&((a=v.user)==null?void 0:a.id)===s.user._id){const B=v.user;B.preferences=(m=s.user)==null?void 0:m.preferences,b(B)}const{url:k}=s.session;window.location.href=k}};return h.useEffect(()=>{switch(o.payment){case"success":g({title:t("Purchase completed successfully"),message:"ðŸŽ‰ "+t("Compliments, {{count}} products have been purchased",{count:w()})+"!",confirmText:t("Go back to products"),onConfirm:()=>{C(),A("/products")}});break;case"cancel":g({title:"ðŸ˜¢ "+t("Purchase has been canceled"),message:t("The purchase was not finalized")+`.
`+t("You can retry, or update your cart")+".",confirmText:t("Ok")});break}},[o.payment]),((E=r.items)==null?void 0:E.length)<=0?e.jsx(W,{children:e.jsx(N,{sx:{marginTop:2,padding:{sx:2,sm:3,md:4}},children:e.jsxs(Q,{children:[e.jsxs(i,{variant:"h6",gutterBottom:!0,sx:{textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(G,{}),t("Cart is empty")]}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",marginTop:2},children:e.jsx(q,{variant:"contained",color:"primary",onClick:()=>A("/products"),children:t("Go to Products")})})]})})}):(console.log("delivery:",x),e.jsx(W,{children:e.jsx(N,{sx:{marginTop:2,padding:{sx:2,sm:3,md:4}},children:e.jsx(Q,{children:e.jsxs(p,{container:!0,columnSpacing:8,rowSpacing:1,sx:{flexGrow:1},children:[e.jsxs(p,{item:!0,xs:12,md:6,sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{variant:"h6",gutterBottom:!0,sx:{textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(G,{}),t("Cart summary")]}),e.jsx(n,{sx:{maxHeight:"33vh",overflowY:"auto",border:"1px solid #ddd",borderRadius:1,padding:1},children:(O=r==null?void 0:r.items)==null?void 0:O.map((s,a)=>{var m;return e.jsxs("div",{children:[e.jsx(be,{item:{id:s._id,title:s.mdaCode,description:s.notes,price:s.price,currency:f,imageName:s.imageName,attribute1key:t("OEM code"),attribute1value:s.oemCode,attribute2key:t("Make"),attribute2value:s.make},quantity:s.quantity??1,onQuantityChange:I,onRemove:S}),a<((m=r==null?void 0:r.items)==null?void 0:m.length)-1&&e.jsx(ue,{})," "]},a)})}),e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",sx:{ml:2},children:[e.jsx(i,{variant:"body2",children:t("Partial total")+" ("+t("{{count}} articles",{count:w()})+")"}),e.jsx(i,{variant:"body1",sx:{mr:5,fontWeight:"bold"},children:j(R,f)})]}),e.jsx(n,{sx:{mt:-2,ml:2},children:e.jsx(i,{variant:"subtitle1",children:t("Duties and taxes included")})}),e.jsxs(pe,{sx:{mt:3,minWidth:120},error:c.delivery,children:[e.jsx(me,{id:"delivery-label",children:t("Delivery method")}),e.jsxs(ye,{labelId:"delivery-label",id:"delivery",value:x.code||"-",label:t("Delivery method"),onChange:te,children:[e.jsx(F,{value:"-",disabled:!0}),u.ecommerce.delivery.methods.map((s,a)=>e.jsx(F,{value:s.code,children:t(s.description)},a))]}),e.jsx(je,{children:c.delivery?t("Please choose a delivery method"):""})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx($,{onClick:se}),e.jsx(i,{variant:z?"subtitle1":"body2",children:t("Is it a gift?")})]}),e.jsx(n,{sx:{mt:-1,ml:6},children:e.jsx(i,{variant:"subtitle1",children:t("In this case we will not put the invoice inside the parcel")})})]})]}),e.jsxs(p,{item:!0,xs:12,md:6,sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{variant:"h6",gutterBottom:!0,sx:{textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(ve,{}),t("Order summary")]}),e.jsx(n,{sx:{maxHeight:"33vh",overflowY:"auto",border:"1px solid #ddd",borderRadius:1,padding:1},children:(L=r==null?void 0:r.items)==null?void 0:L.map((s,a)=>e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",sx:{pl:2},children:[e.jsx(i,{variant:"body2",children:s.mdaCode}),e.jsx(i,{variant:"body2",children:j(s.price,u.currency)})]},a))}),e.jsxs(n,{lineHeight:1.5,children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",sx:{pl:2},children:[e.jsx(i,{variant:"body2",children:t("Partial total")}),e.jsx(i,{variant:"body1",sx:{mr:1,fontWeight:"bold"},children:j(R,f)})]}),e.jsx(n,{sx:{ml:2},children:e.jsx(i,{variant:"subtitle1",children:t("Duties and taxes included")})}),x.code!=="-"&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",sx:{pl:2},children:[e.jsx(i,{variant:"body2",children:t("Delivery costs")}),e.jsx(i,{variant:"body1",sx:{mr:1,fontWeight:"bold"},children:j(x.price,f)})]}),e.jsx(n,{sx:{ml:2},children:e.jsx(i,{variant:"subtitle1",children:x.description})})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",sx:{mt:3,pl:2,py:1.5,backgroundColor:"ochre.dark"},children:[e.jsx(i,{variant:"body1",children:t("ORDER TOTAL")}),e.jsx(i,{variant:"body1",sx:{mr:1,fontWeight:"bold"},children:j(R+(x.code!=="-"?x.price:0),f)})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx($,{checked:K,onChange:ne}),e.jsx(i,{variant:z?"subtitle1":"body2",children:t("Send me e-mail on new products, offers and surprises!")})]}),e.jsxs(q,{variant:"contained",color:"primary",onClick:ie,sx:{width:"fit-content",mx:"auto"},children:[t("Checkout")," "]}),!y&&e.jsx(p,{container:!0,justifyContent:"flex-start",sx:{mt:0},children:e.jsxs(i,{component:"h6",variant:"subtitle1",color:"textSecondary",_align:"center",children:[t("By placing an order")," ",t("you agree to our")," ",e.jsx(M,{href:"/terms-of-use",color:"textPrimary",children:t("terms of use")})," "," ",t("and you confirm you have read our")," ",e.jsx(M,{href:"/privacy-policy",color:"textPrimary",children:t("privacy policy")}),"."]})})]})]})})})}))};J.propTypes={payment:P.string};const Re=V.memo(J);export{Re as default};
