import{a as R,j as e,R as T,b as F,r as l,A as _,n as M,e as O,u as G,o as N,B as a,c as n,T as c,C as b,p as U,F as V,s as w,L as S,i as $,l as B}from"./index-RKOwH3L5.js";import{G as z,F as H}from"./Google-B1fJ1iff.js";import{P as W}from"./Person-C5BLu2CY.js";import{T as Y,L as q}from"./TextFieldPassword-CC09HB0c.js";import{S as J}from"./TextField-BuG7cnXz.js";import{A as K}from"./Avatar-B_ktiCG4.js";import{C as Q}from"./Checkbox-FwaULwe1.js";import{I as X}from"./Icon-DFBSu5xM.js";import"./Select-HLbkRNVN.js";const Z=R(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2M9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9zm9 14H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"}),"LockOutlined");function ee(){const d=F(),[m,p]=l.useState(""),[x,h]=l.useState(""),[f,r]=l.useState({}),{signIn:k}=l.useContext(_),{showDialog:v}=M(),{showSnackbar:i}=O(),{t:s}=G(),[g,I]=l.useState(!1),y=N();y.state;const E=(t,o)=>{t.preventDefault(),window.location.replace(`${n.siteUrl}/api/auth/${o.toLowerCase()}`)},A=t=>{I(t.target.checked)},L=()=>{const t=B(m);if(t!==!0){let o;switch(t){case"ERROR_PLEASE_SUPPLY_AN_EMAIL":o=s("Please supply an email");break;case"ERROR_PLEASE_SUPPLY_A_VALID_EMAIL":o=s("Please supply a valid email");break;default:o=t}return r({email:!0}),i(o,"warning"),!1}if(!x){const o=s("Please supply a password");return r({password:!0}),i(o,"warning"),!1}return!0},P=async t=>{var u,j,C;if(t.preventDefault(),!L())return;r({});const o=await $("post","/auth/signin",{email:m,password:x,rememberMe:!g});if(o.err)switch((u=o.data)==null?void 0:u.code){case"ACCOUNT_WAITING_FOR_VERIFICATION":const D=(j=o.data)==null?void 0:j.codeDeliveryMedium;r({email:!0}),v({title:s("Account is waiting for verification"),message:o.data.message,confirmText:s("Ok"),onConfirm:()=>{d(`/signup/true/${D}`,{replace:!0})}});break;case"ACCOUNT_DELETED":r({email:!0}),i(o.message,"warning");break;default:r({}),i(o.message,"error")}else i(s("Sign in successful"),"success"),console.log("Email signin result:",o),k(o),p(""),h(""),d(((C=y.state)==null?void 0:C.returnUrl)??"/",{replace:!0})};return e.jsx("form",{noValidate:!0,autoComplete:"on",children:e.jsx(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"start",mt:6},children:e.jsxs(a,{sx:{width:"100%",maxWidth:400,p:2,border:"1px solid",borderColor:"primary.main",borderRadius:4},children:[e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:0,mb:3},children:e.jsx(K,{sx:{backgroundColor:"primary.main"},children:e.jsx(Z,{})})}),e.jsx(c,{variant:"body1",color:"textSecondary",sx:{display:"flex",justifyContent:"center",my:1},children:s("Sign in with email and password")}),e.jsx(J,{autoFocus:!0,id:"email",value:m,onChange:t=>p(t.target.value),placeholder:"Email",startIcon:e.jsx(W,{}),autoComplete:"email",error:f.email}),e.jsx(Y,{id:"password",type:"password",value:x,onChange:t=>h(t.target.value),placeholder:s("Password"),startIcon:e.jsx(q,{}),autoComplete:"current-password",error:f.password}),e.jsx(b,{type:"submit",onClick:P,sx:{mt:1,textAlign:"center"},children:s("Sign in")}),e.jsx(a,{display:"flex",justifyContent:"flex-end",children:e.jsx(U,{placement:"bottom",title:s("It is recommended to check this flag if you are on a public computer, with low security")+`.
`+s(`If checked your session will last only for ${w(n.auth.refreshTokenExpirationDontRememberMeSeconds)}`)+", "+s(`otherwise it will last for ${w(n.auth.refreshTokenExpirationSeconds)}`)+".",children:e.jsx(V,{checked:g,onChange:A,labelPlacement:"start",control:e.jsx(Q,{size:"small",color:"primary",sx:{mr:-1}}),label:s("Do not remember me"),color:"text.secondary",sx:{mr:0,"& .MuiFormControlLabel-label":{fontSize:"1rem"}}})})}),e.jsx(a,{sx:{display:"flex",justifyContent:"flex-end",mt:0},children:e.jsx(c,{variant:"body2",color:"textSecondary",children:e.jsx(S,{style:{cursor:"pointer"},underline:"hover",onClick:()=>d("/forgot-password",{replace:!0}),children:s("Forgot password?")})})}),e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsxs(c,{variant:"body2",color:"textSecondary",children:[s("Don't have an account?")," ",e.jsx(S,{style:{cursor:"pointer"},underline:"hover",onClick:()=>d("/signup"),children:s("Register now!")})]})}),n.oauth.federatedSigninProviders.length&&e.jsxs(a,{children:[e.jsx(c,{variant:"body2",color:"textSecondary",sx:{display:"flex",justifyContent:"center",my:3},children:s("or")}),e.jsx(c,{variant:"body2",color:"textSecondary",sx:{display:"flex",justifyContent:"center",my:1},children:s("Sign in with a social account")}),e.jsx(a,{display:"flex",flexDirection:"row",children:n.oauth.federatedSigninProviders.map((t,o)=>e.jsx(b,{startIcon:t==="Google"?e.jsx(z,{sx:{color:"red"}}):t==="Facebook"?e.jsx(H,{sx:{color:"blue"}}):e.jsx(X,{sx:{backgroundColor:"white",color:"red"},children:"G"}),sx:{mr:o<n.oauth.federatedSigninProviders.length-1?1:0},type:t==="Google"?"socialAuthButtonGoogle":t==="Facebook"?"socialAuthButtonFacebook":"",onClick:u=>E(u,t),children:t},t))})]})]})})})}const de=T.memo(ee);export{de as default};
