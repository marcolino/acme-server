import{a as Y,j as e,R as B,r as n,b as X,e as $,u as z,B as i,T as E,C as p,D as G,f as q,g as J,h as K,i as S,l as Q,m as Z}from"./index-RKOwH3L5.js";import{C as ee}from"./ConfirmationNumber-Cw0UM5oe.js";import{T as b,L as v}from"./TextFieldPassword-CC09HB0c.js";import{E as se}from"./Email-DJ3uIJaq.js";import{S as A}from"./TextField-BuG7cnXz.js";import{A as ae}from"./Avatar-B_ktiCG4.js";import"./Select-HLbkRNVN.js";const te=Y(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h2c0-1.66 1.34-3 3-3s3 1.34 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"}),"LockOpenOutlined");function oe(){const[l,y]=n.useState(""),[f,c]=n.useState(""),[C,w]=n.useState(""),[u,r]=n.useState({email:!1,password:!1,passwordConfirmed:!1,code:!1}),[m,x]=n.useState(!1),[I,k]=n.useState(""),[P,g]=n.useState(""),F=X(),[L,R]=n.useState(!1),[N,T]=n.useState(null),[M,V]=n.useState(null),[D,_]=n.useState(null),{showSnackbar:d}=$(),{t}=z(),h=(a,s,o)=>{T(a),V(s),_(()=>o),R(!0)},j=()=>{R(!1),D&&(_(null),D())},O=()=>{if(!m){const a=Q(l);if(a!==!0){let s;switch(a){case"ERROR_PLEASE_SUPPLY_AN_EMAIL":s=t("Please supply an email");break;case"ERROR_PLEASE_SUPPLY_A_VALID_EMAIL":s=t("Please supply a valid email");break;default:s=a}return d(s,"warning"),r({email:!0}),!1}}if(m){const[a,s]=Z(f,C);if(a!==!0){let o;switch(a){case"ERROR_PLEASE_SUPPLY_A_PASSWORD":o=t("Please supply a password");break;case"ERROR_PLEASE_SUPPLY_A_MORE_COMPLEX_PASSWORD":o=t("Please supply a more complex password")+`.

`+s;break;case"PLEASE_CONFIRM_THE_PASSWORD":o=t("Please confirm the password");break;case"ERROR_THE_CONFIRMED_PASSWORD_DOES_NOT_MATCH_THE_PASSWORD":o=t("The confirmed password does not match the password");break;default:o=a}return d(o,"warning"),r({password:!0}),!1}}return!0},W=async a=>{if(a.preventDefault(),!O())return;r({});const s=await S("post","/auth/resetPassword",{email:l});if(s.err)d(s.err,"error"),r({});else{console.devAlert(`SIGNUP VERIFICATION CODE: ${s.code}`),x(!0),c("");const o=s.codeDeliveryMedium;k(o),h(t("Confirmation code sent"),s.message,()=>{})}},U=async a=>{var o;if(a.preventDefault(),!O())return;r({});const s=await S("post","/auth/resetPasswordConfirm",{email:l,code:P,password:f,passwordConfirmed:C});if(s.err)switch(d(s.message,"error"),(o=s.data)==null?void 0:o.code){case"CODE_NOT_FOUND":r({confirmationCode:!0});break;case"CODE_INVALID_OR_EXPIRED":r({confirmationCode:!0});break;default:r({password:!0})}else x(!1),y(""),c(""),w(""),g(""),h(t("Password reset success"),t("You can sign in with your new password"),()=>{F("/signin",{replace:!0})})},H=async a=>{a.preventDefault(),r({});const s=await S("post","/auth/resendResetPasswordCode",{email:l});if(s.err){switch(s.code){case"CODE_NOT_FOUND":r({confirmationCode:!0});break;case"CODE_INVALID_OR_EXPIRED":r({confirmationCode:!0});break;default:r({password:!0})}d(s.message,"warning")}else console.devAlert(`SIGNUP VERIFICATION CODE: ${s.code}`),x(!0),c(""),w(""),g(""),h(t("Reset code resent"),s.message,()=>{})};return e.jsxs("form",{noValidate:!0,autoComplete:"on",children:[e.jsx(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"start",mt:6},children:e.jsxs(i,{sx:{width:"100%",maxWidth:400,p:2,border:"1px solid",borderColor:"primary.main",borderRadius:4},children:[e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:0,mb:3},children:e.jsx(ae,{sx:{backgroundColor:"primary.main"},children:e.jsx(te,{})})}),!m&&e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"body1",color:"textSecondary",sx:{display:"flex",justifyContent:"center",my:1},children:t("Reset password")}),e.jsx(A,{autoFocus:!0,id:"email",value:l,onChange:a=>y(a.target.value),placeholder:t("Email"),startIcon:e.jsx(se,{}),error:u.email}),e.jsx(i,{m:1}),e.jsx(p,{type:"submit",onClick:W,sx:{mt:1,textAlign:"center"},children:t("Request password reset")})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"body1",color:"textSecondary",sx:{display:"flex",justifyContent:"center",my:1},children:t("New password")}),e.jsx(A,{id:"confirmationCode",type:"tel",value:P,autoComplete:"off",onChange:a=>g(a.target.value),placeholder:t("Numeric code received by {{codeDeliveryMedium}}",{codeDeliveryMedium:I}),startIcon:e.jsx(ee,{}),error:u.confirmationCode}),e.jsx(i,{m:1}),e.jsx(b,{autoFocus:!0,id:"password",type:"password",value:f,autoComplete:"new-password",onChange:a=>c(a.target.value),placeholder:t("New password"),startIcon:e.jsx(v,{}),error:u.password}),e.jsx(i,{m:1}),e.jsx(b,{id:"passwordConfirmed",type:"password",value:C,autoComplete:"new-password-confirmation",onChange:a=>w(a.target.value),placeholder:t("New password confirmation"),startIcon:e.jsx(v,{}),error:u.passwordConfirmed}),e.jsx(p,{type:"submit",onClick:U,children:t("Set new password")}),e.jsx(p,{type:"submit",onClick:H,fullWidth:!1,size:"small",color:"tertiary",sx:{float:"right",marginLeft:"auto",marginRight:0,mt:2},children:t("Resend code")})]})]})}),e.jsxs(G,{open:L,onClose:j,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(q,{id:"alert-dialog-title",children:N}),e.jsx(J,{id:"alert-dialog-description",children:e.jsx(E,{variant:"body1",sx:{whiteSpace:"pre-line"},children:M})}),e.jsx(K,{children:e.jsx(p,{onClick:j,fullWidth:!1,autoFocus:!0,children:t("Ok")})})]})]})}const me=B.memo(oe);export{me as default};
