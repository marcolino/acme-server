import{R as A,r,A as O,e as y,d as G,o as _,f as B,u as H,dk as L,j as i,dm as W,bq as $,B as x,c as g,bo as D,k as V,G as m,T as p,F as q,bM as Y}from"./index-B-g6q7zv.js";import{D as w}from"./Divider-Bf6qDKnt.js";const z=e=>{const{auth:t,updateSignedInUserPreferences:S}=r.useContext(O),[f,d]=r.useState(null),{token:k}=y(),[j]=r.useState(k||null),{language:C}=y(),[P]=r.useState(C||null),[c,N]=r.useState(null),U=G(),{showDialog:E}=_(),{showSnackbar:R}=B(),{t:n}=H();r.useEffect(()=>{e.internalRouting||(console.log("language from params:",P),L.changeLanguage(P))},[]);const T=async o=>{try{if(e.internalRouting){if(!t.user)throw new Error(n("You must be authenticated for this action"));d(t.user.id),N(t.user.preferences.notifications)}else{const s=await V("post","/auth/notificationVerification",{token:o});if(s.err)throw new Error(s.message);if(s.user._id)d(s.user._id),N(s.user.preferences.notifications);else throw new Error(n("No user id from token"))}}catch(s){d(!1),console.error(s.message),E({title:n("Authentication error"),message:s.message+`.

`+n("Please")+" "+(t!=null&&t.user?"":n("authenticate (pressing the [Enter] button on top) and then"))+n(`go to "Profile" in user's menu, and use "Notifications preferences" to change your notification preferences`)+".",confirmText:n("Ok")})}};r.useEffect(()=>{f===null&&T(j)},[]);const F=(o,s)=>{N(a=>({...a,[o]:{...a[o],[s]:!a[o][s]}}))},I=async()=>{e.action==="unsubscribe"&&((e.section==="all"||e.section==="email")&&Object.keys(c[e.section]).forEach(o=>{c[e.section][o]=!1}),(e.section==="all"||e.section==="push")&&Object.keys(c[e.section]).forEach(o=>{c[e.section][o]=!1}),(e.section==="all"||e.section==="sms")&&Object.keys(c[e.section]).forEach(o=>{c[e.section][o]=!1})),await M(f,c),E({title:n("Preferences saved"),message:e.action==="unsubscribe"?n("Unsubscription completed"):n("Changes applied successfully"),confirmText:"Close",onConfirm:()=>{v()}})},v=()=>{e.internalRouting?e.onClose():window.close()},M=async(o,s)=>{var l;const a=await V("post",e.internalRouting?"/auth/notificationPreferencesSaveInternal":"/auth/notificationPreferencesSaveExternal",{token:j,userId:o,notificationPreferences:s});if(a.err)throw R(a.message,"error"),new Error(a.message);if(console.log(`*** notificationPreferencesSave${e.internalRouting?"Internal":"External"} result:`,a),((l=t.user)==null?void 0:l.id)===a.user._id){const u=t.user;u.preferences=a.user.preferences,S(u)}U(-1),console.log("/auth/notificationPreferencesSave result:",a)},b=(o,s,a)=>(console.log("renderSection:",o,s,a),i.jsxDEV(m,{container:!0,spacing:1,alignItems:"flex-start",children:[i.jsxDEV(m,{item:!0,xs:12,md:3,children:i.jsxDEV(p,{variant:"h6",sx:{px:2,mr:2,backgroundColor:"secondary.main",borderRadius:1},children:o},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:181,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:180,columnNumber:9},void 0),i.jsxDEV(m,{item:!0,xs:12,md:9,children:a.map(([l,u,h])=>i.jsxDEV(x,{sx:{mb:.2},children:i.jsxDEV(m,{container:!0,alignItems:"center",children:[i.jsxDEV(m,{item:!0,xs:8,children:[i.jsxDEV(p,{variant:"body1",fontWeight:"bold",s_x:{lineHeight:1.2},children:l},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:192,columnNumber:19},void 0),i.jsxDEV(p,{variant:"body2",color:"textSecondary",sx:{lineHeight:1.1},children:u},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:195,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:191,columnNumber:17},void 0),e.action!=="unsubscribe"&&i.jsxDEV(m,{item:!0,xs:4,sx:{pl:2},children:i.jsxDEV(q,{control:i.jsxDEV(Y,{checked:c[s][h],onChange:()=>F(s,h)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:203,columnNumber:25},void 0),label:""},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:201,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:200,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:190,columnNumber:15},void 0)},h,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:189,columnNumber:13},void 0))},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:187,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:178,columnNumber:7},void 0));return f?i.jsxDEV(i.Fragment,{children:[i.jsxDEV(W,{children:[e.section==="all"&&n("Notification preferences"),e.section==="email"&&e.action==="preferences"&&n("Email preferences"),e.section==="email"&&e.action==="unsubscribe"&&n("Email unsubscribe"),e.section==="push"&&e.action==="preferences"&&n("Push notifications preferences"),e.section==="push"&&e.action==="unsubscribe"&&n("Push notifications unsubscribe"),e.section==="sms"&&e.action==="preferences"&&n("SMS preferences"),e.section==="sms"&&e.action==="unsubscribe"&&n("SMS unsubscribe")]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:238,columnNumber:7},void 0),i.jsxDEV($,{maxWidth:"md",children:i.jsxDEV(x,{children:[(e.section==="all"||e.section==="email")&&i.jsxDEV(i.Fragment,{children:[b("Email","email",e.action==="unsubscribe"?[[n("Unsubscribe from all email notifications"),n("Unsubscribe from all emails from {{company}}",{company:g.company.name}),"all"]]:[[n("News and updates"),n("Get updates about product and feature changes"),"newsUpdates"],[n("Tips and tutorials"),n("Learn how to get the most out of our platform"),"tipsTutorials"],[n("Reminders"),n("Notifications for tasks or updates you might have missed"),"reminders"],[n("Offers"),n("New special offers"),"offers"]]),i.jsxDEV(w,{sx:{my:1}},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:266,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:252,columnNumber:13},void 0),(e.section==="all"||e.section==="push")&&i.jsxDEV(i.Fragment,{children:[b("Push","push",e.action==="unsubscribe"?[[n("Unsubscribe from all push notifications"),n("Unsubscribe from all push notifications from {{company}}",{company:g.company.name}),"newsUpdates"]]:[[n("Reminders"),n("Notifications for tasks or updates you might have missed"),"reminders"]]),i.jsxDEV(w,{sx:{my:1}},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:283,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:272,columnNumber:13},void 0),(e.section==="all"||e.section==="sms")&&i.jsxDEV(i.Fragment,{children:b("SMS","sms",e.action==="unsubscribe"?[[n("Unsubscribe from all push notifications"),n("Unsubscribe from all push notifications from {{company}}",{company:g.company.name}),"newsUpdates"]]:[[n("Transaction alerts"),n("Receive alerts for transactions and payments"),"transactionAlerts"],[n("Marketing messages"),n("Get promotional offers and updates"),"marketingMessages"]])},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:289,columnNumber:13},void 0),i.jsxDEV(x,{sx:{textAlign:"end",my:4},children:[i.jsxDEV(D,{color:"primary",variant:"contained",onClick:I,sx:{mx:1},children:n("Confirm")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:307,columnNumber:13},void 0),i.jsxDEV(D,{color:"secondary",variant:"contained",onClick:v,sx:{mx:1},children:n("Cancel")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:315,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:306,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:249,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:248,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/NotificationPreferences.jsx",lineNumber:237,columnNumber:5},void 0):null},Q=A.memo(z);export{Q as default};
