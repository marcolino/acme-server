import{a as ee,j as t,R as $,aq as te,b as ne,e as se,n as re,u as oe,r as f,d8 as ae,i as T,di as E,dj as ce,dk as le,dl as ie,dm as de,dn as me,dp as he,da as ue,B as R,C as D,av as ge,I as A,T as xe}from"./index-RKOwH3L5.js";import{D as B,a as fe,S as pe}from"./StackedArrows-VOs40W91.js";import{C as Ce,S as je,e as ke,b as we,f as ve,h as L,d as a,c as ye,E as Se,g as Pe}from"./TextFieldSearch-D3BeTHhm.js";import{C as _}from"./Checkbox-FwaULwe1.js";import"./Select-HLbkRNVN.js";import"./TextField-BuG7cnXz.js";const be=ee(t.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),Te=()=>{const d=te(),S=ne(),{showSnackbar:C}=se(),{showDialog:P}=re(),{t:o}=oe(),[m,v]=f.useState([]),[j,z]=f.useState(""),O=[5,10,25,50,100],F=e=>l.indexOf(e)!==-1,[c,H]=f.useState("mdaCode"),[i,M]=f.useState("asc");B.fromJSDate(new Date).setLocale(ae.language).toLocaleString(B.DATETIME_FULL),f.useEffect(()=>((async()=>{const e=await T("get","/product/getProducts");e.err?C(e.message,e.status===401?"warning":"error"):v(e.products)})(),()=>{}),[]);const N=()=>{S("/edit-product/<new>")},b=e=>T("post","/product/removeProduct",e),W=e=>{S(`/edit-product/${e}`)},I=async e=>{b({filter:[e]}).then(n=>{if(n.err){console.warn("removeProduct error:",n),C(o("Error removing product: {{err}}",{err:n.message}),"error");return}v(s=>s.filter(r=>r._id!==e))}).catch(n=>{console.error(`Error removing product with id ${e}: ${n.message}`),C(o("Error removing product with id {{id}}: {{err}",{id:e,err:n.message}),"error")})},U=async(e,n)=>{b({filter:e,...n}).then(s=>{if(s.err){console.warn("bulkRemove product error:",s),C(o("Error bulk removing product: {{err}}",{err:s.message}),"error");return}v(r=>r.filter(p=>!e.includes(p._id))),w([]),C(o("Removed {{ count }} products",{count:e.length}),"success")}).catch(s=>{console.error(`Error bulk removing ${e.length} products with ids ${e}: ${s.message}`),C(o("Error bulk removing {{count}} products: {{err}}",{count:e.length,err:s.message}),"error")})},[y,q]=f.useState(0),[k,G]=f.useState(()=>parseInt(E.get("productsRowsPerPage"))||10),[l,w]=f.useState([]),J=e=>{z(e.target.value)},V=(e,n)=>{q(n)},K=e=>{const n=parseInt(e.target.value);G(n),E.set("productsRowsPerPage",n)},Q=e=>{if(e.target.checked){const n=m.map(s=>s._id);w(n);return}w([])},X=(e,n)=>{const s=l.indexOf(n);let r=[];s===-1?r=r.concat(l,n):s===0?r=r.concat(l.slice(1)):s===l.length-1?r=r.concat(l.slice(0,-1)):s>0&&(r=r.concat(l.slice(0,s),l.slice(s+1))),w(r)},h=e=>()=>{let n="asc";c===e&&i==="asc"&&(n="desc"),H(e),M(n)},Y=$.useMemo(()=>{let e=[...m];return c!==null&&e.sort((n,s)=>{var r,p;if(ce(n[c])){let g=(r=n[c])==null?void 0:r.toLowerCase(),x=(p=s[c])==null?void 0:p.toLowerCase();return g<x?i==="asc"?-1:1:g>x?i==="asc"?1:-1:0}if(le(n[c])||ie(n[c])){const g=n[c],x=s[c];return g<x?i==="asc"?-1:1:g>x?i==="asc"?1:-1:0}if(de(n[c])){let g=n[c][0].priority,x=s[c][0].priority;if(g<x)return i==="asc"?-1:1;if(g>x)return i==="asc"?1:-1}return me(n[c])?i==="asc"?-1:1:he(n[c])?(console.warn(`sort of "object" field type for column ${c} is not implemented yet!`),0):(console.error(`sort of unknown field type for column ${c} is not implemented yet!`),0)}),e},[m,c,i]),Z=()=>{if(!m||!m.length)return[];const e=j==null?void 0:j.toLowerCase(),n=r=>j?s(r,"mdaCode")||s(r,"oemCode")||s(r,"make")||s(r,"application")||s(r,"kw")||s(r,"volt")||s(r,"ampere")||s(r,"teeth")||s(r,"type")||s(r,"notes"):!0,s=(r,p)=>!r||!r[p]?!1:r[p].toString().toLowerCase().includes(e);return Y.filter(r=>n(r)).slice(y*k,y*k+k)},u=e=>t.jsx(xe,{component:"span",children:c===e.column?i==="asc"?"▼":"▲":t.jsx(pe,{opacity:.4})});return t.jsxs(t.Fragment,{children:[t.jsx(ue,{children:o("Products handling")}),t.jsxs(R,{sx:{my:d.spacing(2),display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%"},children:[t.jsx(Ce,{label:o("Search"),value:j,size:"small",margin:"dense",onChange:J,startIcon:t.jsx(je,{}),fullWidth:!1,sx:{color:d.palette.text.primary}}),t.jsx(D,{onClick:N,fullWidth:!1,variant:"contained",color:"primary",size:"small",startIcon:t.jsx(be,{}),hideChildrenUpToBreakpoint:"sm",sx:{mt:d.spacing(.3),py:d.spacing(.8),ml:d.spacing(2)},children:o("New product")})]}),t.jsxs(ge,{sx:{overflow:"hidden",backgroundColor:d.palette.background.default,color:d.palette.text.secondary},children:[t.jsx(ke,{sx:{maxHeight:"max(12rem, calc(100vh - 26rem))"},children:t.jsxs(we,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(ve,{children:t.jsxs(L,{sx:e=>({"& th":{backgroundColor:e.palette.secondary.main,color:e.palette.common.black,py:0,whiteSpace:"nowrap"}}),children:[t.jsx(a,{padding:"checkbox",children:t.jsx(_,{indeterminate:l.length>0&&l.length<m.length,checked:m.length>0&&l.length===m.length,onChange:Q})}),t.jsxs(a,{onClick:h("mdaCode"),children:[o("MDA code")," ",u({column:"mdaCode"})]}),t.jsxs(a,{onClick:h("oemCode"),children:[o("OEM code")," ",u({column:"oemCode"})]}),t.jsxs(a,{onClick:h("make"),children:[o("Make")," ",u({column:"make"})]}),t.jsxs(a,{onClick:h("application"),children:[o("Application")," ",u({column:"application"})]}),t.jsxs(a,{onClick:h("kw"),children:[o("kW")," ",u({column:"kw"})]}),t.jsxs(a,{onClick:h("volt"),children:[o("Volt")," ",u({column:"volt"})]}),t.jsxs(a,{onClick:h("ampere"),children:[o("Ampere")," ",u({column:"ampere"})]}),t.jsx(a,{children:o("Teeth")}),t.jsxs(a,{onClick:h("type"),children:[o("Type")," ",u({column:"type"})]}),t.jsx(a,{children:o("Notes")}),t.jsx(a,{children:o("Actions")})]})}),t.jsx(ye,{children:Z().map(e=>{const n=F(e._id);return t.jsxs(L,{hover:!0,onClick:s=>X(s,e._id),role:"checkbox","aria-checked":n,tabIndex:-1,selected:n,sx:s=>({"& td":{backgroundColor:s.palette.ochre.light,color:s.palette.common.text,py:0}}),children:[t.jsx(a,{padding:"checkbox",children:t.jsx(_,{checked:n})}),t.jsx(a,{children:e.mdaCode}),t.jsx(a,{children:e.oemCode}),t.jsx(a,{children:e.make}),t.jsx(a,{children:e.application}),t.jsx(a,{children:e.kw}),t.jsx(a,{children:e.volt}),t.jsx(a,{children:e.ampere}),t.jsx(a,{children:e.teeth}),t.jsx(a,{children:e.type}),t.jsx(a,{children:e.notes}),t.jsxs(a,{children:[t.jsx(A,{size:"small",onClick:()=>W(e._id),children:t.jsx(Se,{fontSize:"small"})}),t.jsx(A,{size:"small",onClick:()=>P({onConfirm:()=>I(e._id),title:o("Confirm Delete"),message:o("Are you sure you want to delete {{count}} selected product?",{count:1}),confirmText:o("Confirm"),cancelText:o("Cancel")}),children:t.jsx(fe,{fontSize:"small"})})]})]},e._id)})})]})}),t.jsx(Pe,{rowsPerPageOptions:O,component:"div",count:m.length,rowsPerPage:k,page:y,onPageChange:V,onRowsPerPageChange:K}),t.jsx(R,{sx:{padding:d.spacing(2)},children:t.jsx(D,{variant:"contained",color:"primary",fullWidth:!1,onClick:()=>P({onConfirm:()=>U(l),title:o("Confirm Delete"),message:o("Are you sure you want to delete {{count}} selected product?",{count:l.length}),confirmText:o("Confirm"),cancelText:o("Cancel")}),disabled:l.length===0,sx:{mr:d.spacing(2)},children:o("Remove selected products")})})]})]})},_e=$.memo(Te);export{_e as default};
