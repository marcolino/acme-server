import{R as D,r as c,A as G,d as C,b as _,n as H,e as L,u as W,d8 as $,j as s,da as V,bf as Y,B as x,c as y,bd as E,i as v,G as l,T as j,F as q,bB as z}from"./index-RKOwH3L5.js";import{D as U}from"./Divider-CCWPHBZV.js";const J=e=>{const{auth:o,updateSignedInUserPreferences:R}=c.useContext(G),[m,d]=c.useState(null),{token:N}=C(),[w]=c.useState(N||null),{language:T}=C(),[S]=c.useState(T||null),[r,h]=c.useState(null),F=_(),{showDialog:P}=H(),{showSnackbar:I}=L(),{t:n}=W();c.useEffect(()=>{e.internalRouting||(console.log("language from params:",S),$.changeLanguage(S))},[]);const A=async i=>{try{if(e.internalRouting){if(!o.user)throw new Error(n("You must be authenticated for this action"));d(o.user.id),h(o.user.preferences.notifications)}else{const t=await v("post","/auth/notificationVerification",{token:i});if(t.err)throw new Error(t.message);if(t.user._id)d(t.user._id),h(t.user.preferences.notifications);else throw new Error(n("No user id from token"))}}catch(t){d(!1),console.error(t.message),P({title:n("Authentication error"),message:t.message+`.

`+n("Please")+" "+(o!=null&&o.user?"":n("authenticate (pressing the [Enter] button on top) and then"))+n(`go to "Profile" in user's menu, and use "Notifications preferences" to change your notification preferences`)+".",confirmText:n("Ok")})}};c.useEffect(()=>{m===null&&A(w)},[]);const M=(i,t)=>{h(a=>({...a,[i]:{...a[i],[t]:!a[i][t]}}))},O=async()=>{e.action==="unsubscribe"&&((e.section==="all"||e.section==="email")&&Object.keys(r[e.section]).forEach(i=>{r[e.section][i]=!1}),(e.section==="all"||e.section==="push")&&Object.keys(r[e.section]).forEach(i=>{r[e.section][i]=!1}),(e.section==="all"||e.section==="sms")&&Object.keys(r[e.section]).forEach(i=>{r[e.section][i]=!1})),await B(m,r),P({title:n("Preferences saved"),message:e.action==="unsubscribe"?n("Unsubscription completed"):n("Changes applied successfully"),confirmText:"Close",onConfirm:()=>{k()}})},k=()=>{e.internalRouting?e.onClose():window.close()},B=async(i,t)=>{var u;const a=await v("post",e.internalRouting?"/auth/notificationPreferencesSaveInternal":"/auth/notificationPreferencesSaveExternal",{token:w,userId:i,notificationPreferences:t});if(a.err)throw I(a.message,"error"),new Error(a.message);if(console.log(`*** notificationPreferencesSave${e.internalRouting?"Internal":"External"} result:`,a),((u=o.user)==null?void 0:u.id)===a.user._id){const f=o.user;f.preferences=a.user.preferences,R(f)}F(-1),console.log("/auth/notificationPreferencesSave result:",a)},g=(i,t,a)=>(console.log("renderSection:",i,t,a),s.jsxs(l,{container:!0,spacing:1,alignItems:"flex-start",children:[s.jsx(l,{item:!0,xs:12,md:3,children:s.jsx(j,{variant:"h6",sx:{px:2,mr:2,backgroundColor:"secondary.main",borderRadius:1},children:i})}),s.jsx(l,{item:!0,xs:12,md:9,children:a.map(([u,f,b])=>s.jsx(x,{sx:{mb:.2},children:s.jsxs(l,{container:!0,alignItems:"center",children:[s.jsxs(l,{item:!0,xs:8,children:[s.jsx(j,{variant:"body1",fontWeight:"bold",s_x:{lineHeight:1.2},children:u}),s.jsx(j,{variant:"body2",color:"textSecondary",sx:{lineHeight:1.1},children:f})]}),e.action!=="unsubscribe"&&s.jsx(l,{item:!0,xs:4,sx:{pl:2},children:s.jsx(q,{control:s.jsx(z,{checked:r[t][b],onChange:()=>M(t,b)}),label:""})})]})},b))})]}));return m?s.jsxs(s.Fragment,{children:[s.jsxs(V,{children:[e.section==="all"&&n("Notification preferences"),e.section==="email"&&e.action==="preferences"&&n("Email preferences"),e.section==="email"&&e.action==="unsubscribe"&&n("Email unsubscribe"),e.section==="push"&&e.action==="preferences"&&n("Push notifications preferences"),e.section==="push"&&e.action==="unsubscribe"&&n("Push notifications unsubscribe"),e.section==="sms"&&e.action==="preferences"&&n("SMS preferences"),e.section==="sms"&&e.action==="unsubscribe"&&n("SMS unsubscribe")]}),s.jsx(Y,{maxWidth:"md",children:s.jsxs(x,{children:[(e.section==="all"||e.section==="email")&&s.jsxs(s.Fragment,{children:[g("Email","email",e.action==="unsubscribe"?[[n("Unsubscribe from all email notifications"),n("Unsubscribe from all emails from {{company}}",{company:y.company.name}),"all"]]:[[n("News and updates"),n("Get updates about product and feature changes"),"newsUpdates"],[n("Tips and tutorials"),n("Learn how to get the most out of our platform"),"tipsTutorials"],[n("Reminders"),n("Notifications for tasks or updates you might have missed"),"reminders"],[n("Offers"),n("New special offers"),"offers"]]),s.jsx(U,{sx:{my:1}})]}),(e.section==="all"||e.section==="push")&&s.jsxs(s.Fragment,{children:[g("Push","push",e.action==="unsubscribe"?[[n("Unsubscribe from all push notifications"),n("Unsubscribe from all push notifications from {{company}}",{company:y.company.name}),"newsUpdates"]]:[[n("Reminders"),n("Notifications for tasks or updates you might have missed"),"reminders"]]),s.jsx(U,{sx:{my:1}})]}),(e.section==="all"||e.section==="sms")&&s.jsx(s.Fragment,{children:g("SMS","sms",e.action==="unsubscribe"?[[n("Unsubscribe from all push notifications"),n("Unsubscribe from all push notifications from {{company}}",{company:y.company.name}),"newsUpdates"]]:[[n("Transaction alerts"),n("Receive alerts for transactions and payments"),"transactionAlerts"],[n("Marketing messages"),n("Get promotional offers and updates"),"marketingMessages"]])}),s.jsxs(x,{sx:{textAlign:"end",my:4},children:[s.jsx(E,{color:"primary",variant:"contained",onClick:O,sx:{mx:1},children:n("Confirm")}),s.jsx(E,{color:"secondary",variant:"contained",onClick:k,sx:{mx:1},children:n("Cancel")})]})]})})]}):null},X=D.memo(J);export{X as default};
