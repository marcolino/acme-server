import{a as Q,b as X,f as Z,u as ee,r as c,o as se,j as s,D as ve,g as De,h as Ce,B as D,i as Ve,bo as C,R as ne,at as Ue,d as ye,A as Se,dl as He,k as T,dw as q,dx as we,dy as ke,dz as Te,dA as Pe,dB as Ae,dC as Re,dn as $e,az as Be,q as F,I as z,T as Le}from"./index-kZazlTzH.js";import{D as G,a as Fe,S as ze}from"./StackedArrows-BYhKkvdi.js";import{C as Ie,S as Oe,e as Me,b as _e,f as We,h as J,d as m,c as qe,E as Ge,g as Je}from"./TextFieldSearch-BI4SmVTP.js";import{S as Y,I as Ye}from"./TextField-BpUCQOYc.js";import{C as K}from"./Checkbox-Dr2wjAIy.js";import"./Select-BP4I_6h9.js";const Ke=Q(X.jsx("path",{fillRule:"evenodd",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m4.9 13.49-1.4 1.4c-.2.2-.51.2-.71 0l-3.41-3.41c-1.22.43-2.64.17-3.62-.81-1.11-1.11-1.3-2.79-.59-4.1l2.35 2.35 1.41-1.41-2.35-2.34c1.32-.71 2.99-.52 4.1.59.98.98 1.24 2.4.81 3.62l3.41 3.41c.19.19.19.51 0 .7"}),"BuildCircle"),Qe=Q(X.jsx("path",{d:"M14 17H4v2h10zm6-8H4v2h16zM4 15h16v-2H4zM4 5v2h16V5z"}),"Subject");function Xe({open:N,onClose:V,onConfirm:P}){const{showSnackbar:p}=Z(),{t:d}=ee(),[o,u]=c.useState(""),[x,j]=c.useState(""),[U,g]=c.useState({}),{showDialog:y}=se(),A=d("Email composition"),S=d('In the email subject and in the email body you can use these "strings", enclosed among "$" signs, which will be replaced with the values for each user, before sending each email')+`: 

`+d(`     • $NAME$ => The name of the user
     • $SURNAME$ => The surname of the user
     • $EMAIL$ => The email of the user
     • $PHONE$ => The phone of the user
     • $ADDRESS$ => The address of the user
     • $FISCALCODE$ => The fiscal code/VAT of the user
     • $ROLES$ => The role or roles of the user
     • $PLAN$ => The plan of the user
     • $COMPANY$ => The company of the user
`),R=()=>{if(!o){let l=d("Please supply an email subject");return g({subject:l}),p(l,"warning"),!1}if(!x){let l=d("Please supply an email body");return g({body:l}),p(l,"warning"),!1}return!0},H=()=>{u(""),j("")},r=l=>{V(),H()},$=l=>{l.preventDefault(),R()&&(g({}),P({subject:o,body:x}),H())};return s.jsxDEV(ve,{open:N,onClose:V,fullWidth:!0,maxWidth:"sm",children:[s.jsxDEV(De,{children:d("Create and send email")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:85,columnNumber:7},this),s.jsxDEV(Ce,{children:s.jsxDEV(D,{display:"flex",flexDirection:"column",gap:2,children:[s.jsxDEV(Y,{autoFocus:!0,id:"subject",value:o,onChange:l=>u(l.target.value),placeholder:d("Email subject"),InputProps:{startAdornment:s.jsxDEV(Ye,{position:"start",children:s.jsxDEV(Qe,{},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:98,columnNumber:19},this)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:97,columnNumber:17},this)},title:d("Subject"),error:U.subject},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:88,columnNumber:11},this),s.jsxDEV(D,{m:0},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:105,columnNumber:11},this),s.jsxDEV(Y,{id:"body",value:x,onChange:l=>j(l.target.value),placeholder:d("Email body"),error:U.body,multiline:!0,rows:4},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:106,columnNumber:11},this),s.jsxDEV(D,{m:0},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:115,columnNumber:11},this)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:87,columnNumber:9},this)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:86,columnNumber:7},this),s.jsxDEV(Ve,{children:[s.jsxDEV(C,{onClick:()=>y({title:A,message:S,confirmText:d("Ok")}),color:"secondary",variant:"contained",children:"?"},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:119,columnNumber:9},this),s.jsxDEV(C,{onClick:r,color:"secondary",variant:"contained",children:d("Cancel")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:128,columnNumber:9},this),s.jsxDEV(C,{onClick:$,color:"primary",variant:"contained",children:d("Send email")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:131,columnNumber:9},this)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:118,columnNumber:7},this)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/DialogEmailCreation.jsx",lineNumber:79,columnNumber:5},this)}const Ze=()=>{const N=Ue(),V=ye(),{auth:P}=c.useContext(Se),{showSnackbar:p}=Z(),{showDialog:d}=se(),{t:o}=ee(),[u,x]=c.useState([]),[j,U]=c.useState(""),[g,y]=c.useState(""),[A,S]=c.useState(!1),R=[5,10,25,50,100],H=e=>t.indexOf(e)!==-1,[r,$]=c.useState("lastName"),[l,oe]=c.useState("asc");G.fromJSDate(new Date).setLocale(He.language).toLocaleString(G.DATETIME_FULL),c.useEffect(()=>((async()=>{const e=await T("get","/user/getAllUsersWithTokens");e.err?p(e.message,e.status===401?"warning":"error"):(x(e.users),S(!1))})(),()=>{}),[P.user,A]);const I=async e=>{const n=await T("post","/user/removeUser",e);return n.err?(p(n.message,"error"),!1):!0},ie=async e=>{const n=await T("post","/user/sendEmailToUsers",e);return n.err?(p(n.message,"error"),!1):!0},ae=async e=>{const n=await T("post","/user/promoteToDealer",{userId:e});return n.err?(p(n.message,"error"),!1):(n.count>0?p(o("User has been promoted to {{role}}",{role:o("dealer")}),"info"):p(o("User was a {{role}} already",{role:o("dealer")}),"info"),S(!0),!0)},le=e=>{V(`/edit-user/${e}/userEdit`)},O=async e=>{await I({filter:[e]})&&(x(i=>i.filter(a=>a._id!==e)),ue(null))},re=async(e,n)=>{ie({filter:e,...n})},M=async(e,n)=>{await I({filter:e,...n})&&(x(a=>a.filter(b=>!e.includes(b._id))),k([]),p(o("Removed {{count}} users",{count:e.length}),"success"))},[B,te]=c.useState(0),[w,me]=c.useState(()=>parseInt(q.get("usersRowsPerPage"))||10),[t,k]=c.useState([]),[ce,ue]=c.useState(null),de=e=>{U(e.target.value)},fe=(e,n)=>{te(n)},pe=e=>{const n=parseInt(e.target.value);me(n),q.set("usersRowsPerPage",n)},he=e=>{if(e.target.checked){const n=u.map(i=>i._id);k(n);return}k([])},Ne=(e,n)=>{const i=t.indexOf(n);let a=[];i===-1?a=a.concat(t,n):i===0?a=a.concat(t.slice(1)):i===t.length-1?a=a.concat(t.slice(0,-1)):i>0&&(a=a.concat(t.slice(0,i),t.slice(i+1))),k(a)},be=(e,n)=>{switch(e){case"remove":O(ce);break;case"removeBulk":M(t);break;case"emailBulk":re(t,n);break;default:p(o("Unforeseen bulk action {{action}}",{action:e}),"error")}},E=e=>()=>{let n="asc";r===e&&l==="asc"&&(n="desc"),$(e),oe(n)},[xe,_]=c.useState(!1),je=e=>{y(e),_(!0)},W=()=>{_(!1),y("")},ge=e=>{be(t,g),W()},L=ne.useMemo(()=>{let e=[...u];if(r!==null){const n=u.filter(a=>a[r]!==void 0),i=u.filter(a=>a[r]===void 0);return n.sort((a,b)=>{if(we(a[r])){const f=a[r].toLowerCase(),h=b[r].toLowerCase();return f<h?l==="asc"?-1:1:f>h?l==="asc"?1:-1:0}if(ke(a[r])||Te(a[r])){const f=a[r],h=b[r];return f<h?l==="asc"?-1:1:f>h?l==="asc"?1:-1:0}if(Pe(a[r])){let f=a[r][0].priority,h=b[r][0].priority;return f<h?l==="asc"?-1:1:f>h?l==="asc"?1:-1:0}return Ae(a[r])?l==="asc"?-1:1:Re(a[r])?(console.warn(`sort of "object" field type for column ${r} is not implemented yet!`),0):(console.error(`sort of unknown field type for column ${r} is not implemented yet!`),0)}),l==="asc"?[...n,...i]:[...i,...n]}return e},[u,r,l]);c.useEffect(()=>{console.log("users:",u),console.log("sortedUsers:",L)},[u,L]);const Ee=()=>{if(!u||!u.length)return[];const e=j==null?void 0:j.toLowerCase(),n=(i,a)=>{let b=i[a];return!i||!i[a]?!1:(a==="roles"&&(b=b.sort((f,h)=>f.priority<h.priority).map(f=>f.name.toLowerCase()).join(", ")),b.toString().toLowerCase().includes(e))};return L.filter(i=>n(i,"firstName")||n(i,"lastName")||n(i,"email")||n(i,"phone")||n(i,"roles")||n(i,"fiscalCode")||n(i,"businessName")).slice(B*w,B*w+w)},v=e=>s.jsxDEV(Le,{component:"span",children:r===e.column?l==="asc"?"▼":"▲":s.jsxDEV(ze,{opacity:.4},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:330,columnNumber:82},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:329,columnNumber:7},void 0);return s.jsxDEV(s.Fragment,{children:[s.jsxDEV($e,{children:o("Users handling")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:337,columnNumber:7},void 0),s.jsxDEV(D,{sx:{my:N.spacing(2),display:"flex",justifyContent:"flex-end",width:"100%"},children:s.jsxDEV(Ie,{label:o("Search"),value:j,onChange:de,startIcon:s.jsxDEV(Oe,{},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:351,columnNumber:22},void 0),fullWidth:!1,sx:{color:N.palette.text.primary}},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:347,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:341,columnNumber:7},void 0),s.jsxDEV(Be,{sx:{overflow:"hidden",backgroundColor:N.palette.background.default,color:N.palette.text.secondary},children:[s.jsxDEV(Me,{sx:{maxHeight:"max(12rem, calc(100vh - 26rem))"},children:s.jsxDEV(_e,{stickyHeader:!0,"aria-label":"sticky table",children:[s.jsxDEV(We,{children:s.jsxDEV(J,{sx:e=>({"& th":{backgroundColor:e.palette.secondary.main,color:e.palette.common.black,py:0,whiteSpace:"nowrap"}}),children:[s.jsxDEV(m,{padding:"checkbox",children:s.jsxDEV(K,{indeterminate:t.length>0&&t.length<u.length,checked:u.length>0&&t.length===u.length,onChange:he},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:379,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:378,columnNumber:17},void 0),s.jsxDEV(m,{onClick:E("firstName"),children:[o("First name")," ",v({column:"firstName"})]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:385,columnNumber:17},void 0),s.jsxDEV(m,{onClick:E("lastName"),children:[o("Last name")," ",v({column:"lastName"})]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:388,columnNumber:17},void 0),s.jsxDEV(m,{onClick:E("email"),children:[o("Email")," ",v({column:"email"})]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:391,columnNumber:17},void 0),s.jsxDEV(m,{children:o("Phone")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:394,columnNumber:17},void 0),s.jsxDEV(m,{onClick:E("roles"),children:[o("Roles")," ",v({column:"roles"})]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:397,columnNumber:17},void 0),s.jsxDEV(m,{children:o("Fiscal code")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:400,columnNumber:17},void 0),s.jsxDEV(m,{onClick:E("businessName"),children:[o("Business name")," ",v({column:"businessName"})]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:403,columnNumber:17},void 0),s.jsxDEV(m,{children:o("Actions")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:406,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:369,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:368,columnNumber:13},void 0),s.jsxDEV(qe,{children:Ee().map(e=>{const n=H(e._id);return s.jsxDEV(J,{hover:!0,onClick:i=>Ne(i,e._id),role:"checkbox","aria-checked":n,tabIndex:-1,selected:n,sx:i=>({"& td":{backgroundColor:i.palette.ochre.light,color:i.palette.common.text,py:0}}),children:[s.jsxDEV(m,{padding:"checkbox",children:s.jsxDEV(K,{checked:n},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:436,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:435,columnNumber:23},void 0),s.jsxDEV(m,{children:e.firstName},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:438,columnNumber:23},void 0),s.jsxDEV(m,{children:e.lastName},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:439,columnNumber:23},void 0),s.jsxDEV(m,{children:e.email},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:440,columnNumber:23},void 0),s.jsxDEV(m,{children:e.phone},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:441,columnNumber:23},void 0),s.jsxDEV(m,{children:e.roles.sort((i,a)=>i.priority<a.priority).map(i=>i.name).join(", ")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:442,columnNumber:23},void 0),s.jsxDEV(m,{children:e.fiscalCode},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:443,columnNumber:23},void 0),s.jsxDEV(m,{children:e.businessName},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:444,columnNumber:23},void 0),s.jsxDEV(m,{children:[s.jsxDEV(F,{title:o("Edit user"),children:s.jsxDEV(z,{size:"small",onClick:()=>le(e._id),children:s.jsxDEV(Ge,{fontSize:"small"},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:448,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:447,columnNumber:27},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:446,columnNumber:25},void 0),s.jsxDEV(F,{title:o("Promote to {{role}}",{role:"dealer"}),children:s.jsxDEV(z,{size:"small",onClick:()=>ae(e._id),children:s.jsxDEV(Ke,{fontSize:"small"},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:453,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:452,columnNumber:27},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:451,columnNumber:25},void 0),s.jsxDEV(F,{title:o("Remove user"),children:s.jsxDEV(z,{size:"small",onClick:()=>d({onConfirm:()=>O(e._id),title:o("Confirm Delete"),message:o("Are you sure you want to delete selected {{count}} user?",{count:1}),confirmText:o("Confirm"),cancelText:o("Cancel")}),children:s.jsxDEV(Fe,{fontSize:"small"},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:468,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:458,columnNumber:27},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:456,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:445,columnNumber:23},void 0)]},e._id,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:419,columnNumber:21},void 0)})},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:411,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:367,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:364,columnNumber:9},void 0),s.jsxDEV(Je,{rowsPerPageOptions:R,component:"div",count:u.length,rowsPerPage:w,page:B,onPageChange:fe,onRowsPerPageChange:pe},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:478,columnNumber:9},void 0),s.jsxDEV(D,{sx:{padding:N.spacing(2)},children:[s.jsxDEV(C,{variant:"contained",color:"primary",onClick:()=>je("emailBulk"),disabled:t.length===0,sx:{mr:N.spacing(2),my:.3},children:o("Email users")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:488,columnNumber:11},void 0),s.jsxDEV(C,{variant:"contained",color:"primary",onClick:()=>d({onConfirm:()=>M(t),title:o("Confirm Delete"),message:o("Are you sure you want to delete selected {{count}} user?",{count:t.length}),confirmText:o("Confirm"),cancelText:o("Cancel")}),disabled:t.length===0,sx:{mr:N.spacing(2),my:.3},children:o("Remove users")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:504,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:487,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:359,columnNumber:7},void 0),s.jsxDEV(Xe,{open:xe,onClose:W,onConfirm:ge,message:o("Are you sure you want to send this email to {{count}} selected user?",{count:t.length}),confirmText:o("Send email to {{count}} selected users",{count:t.length}),cancelText:o("Cancel")},void 0,!1,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:533,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/marco/apps/sistemisolari/acme-client/src/components/UsersHandle.jsx",lineNumber:336,columnNumber:5},void 0)},ls=ne.memo(Ze);export{ls as default};
