import{a as u,j as t,aq as T,as as se,T as re,R as ne,b as le,r as m,A as ce,e as ie,u as de,d as me,i as f,da as pe,B as C,G as k,C as z,c as O}from"./index-RKOwH3L5.js";import{S as ue}from"./Select-BDCFKnP2.js";import{S as p}from"./TextField-BuG7cnXz.js";import{I as E}from"./ImageContainer-BAwhbrCZ.js";import"./Select-HLbkRNVN.js";const H=u(t.jsx("path",{d:"m14 12-2 2-2-2 2-2zm-2-6 2.12 2.12 2.5-2.5L12 1 7.38 5.62l2.5 2.5zm-6 6 2.12-2.12-2.5-2.5L1 12l4.62 4.62 2.5-2.5zm12 0-2.12 2.12 2.5 2.5L23 12l-4.62-4.62-2.5 2.5zm-6 6-2.12-2.12-2.5 2.5L12 23l4.62-4.62-2.5-2.5z"}),"Api"),he=u(t.jsx("path",{d:"M4 8h4V4H4zm6 12h4v-4h-4zm-6 0h4v-4H4zm0-6h4v-4H4zm6 0h4v-4h-4zm6-10v4h4V4zm-6 4h4V4h-4zm6 6h4v-4h-4zm0 6h4v-4h-4z"}),"Apps"),ge=u(t.jsx("path",{d:"M12 4H5C3.34 4 2 5.34 2 7v8c0 1.66 1.34 3 3 3l-1 1v1h1l2-2.03L9 18v-5H4V5.98L13 6v2h2V7c0-1.66-1.34-3-3-3M5 14c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m15.57-4.34c-.14-.4-.52-.66-.97-.66h-7.19c-.46 0-.83.26-.98.66L10 13.77l.01 5.51c0 .38.31.72.69.72h.62c.38 0 .68-.38.68-.76V18h8v1.24c0 .38.31.76.69.76h.61c.38 0 .69-.34.69-.72l.01-1.37v-4.14zm-8.16.34h7.19l1.03 3h-9.25zM12 16c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m8 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"Commute"),xe=u(t.jsx("path",{d:"M18.92 5.01C18.72 4.42 18.16 4 17.5 4h-11c-.66 0-1.21.42-1.42 1.01L3 11v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8zM6.5 15c-.83 0-1.5-.67-1.5-1.5S5.67 12 6.5 12s1.5.67 1.5 1.5S7.33 15 6.5 15m11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M5 10l1.5-4.5h11L19 10z"}),"DriveEta"),fe=u(t.jsx("path",{d:"M3 10h11v2H3zm0-2h11V6H3zm0 8h7v-2H3zm15.01-3.13.71-.71c.39-.39 1.02-.39 1.41 0l.71.71c.39.39.39 1.02 0 1.41l-.71.71zm-.71.71-5.3 5.3V21h2.12l5.3-5.3z"}),"EditNote"),Ce=u(t.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M6 7h5v1.5H6zm13 12H5L19 5zm-4.5-3v2H16v-2h2v-1.5h-2v-2h-1.5v2h-2V16z"}),"Exposure"),je=u([t.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),t.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),ve=u(t.jsx("path",{d:"M16.01 7 16 3h-2v4h-4V3H8v4h-.01C7 6.99 6 7.99 6 8.99v5.49L9.5 18v3h5v-3l3.5-3.51v-5.5c0-1-1-2-1.99-1.99"}),"Power"),ye=u(t.jsx("path",{d:"M17.41 6.59 15 5.5l2.41-1.09L18.5 2l1.09 2.41L22 5.5l-2.41 1.09L18.5 9zm3.87 6.13L20.5 11l-.78 1.72-1.72.78 1.72.78.78 1.72.78-1.72L23 13.5zm-5.04 1.65 1.94 1.47-2.5 4.33-2.24-.94c-.2.13-.42.26-.64.37l-.3 2.4h-5l-.3-2.41c-.22-.11-.43-.23-.64-.37l-2.24.94-2.5-4.33 1.94-1.47c-.01-.11-.01-.24-.01-.36s0-.25.01-.37l-1.94-1.47 2.5-4.33 2.24.94c.2-.13.42-.26.64-.37L7.5 6h5l.3 2.41c.22.11.43.23.64.37l2.24-.94 2.5 4.33-1.94 1.47c.01.12.01.24.01.37s0 .24-.01.36M13 14c0-1.66-1.34-3-3-3s-3 1.34-3 3 1.34 3 3 3 3-1.34 3-3"}),"SettingsSuggest"),Ie=u(t.jsx("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Sync"),be=u(t.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"}),"TurnedInNotOutlined"),ke=se("div")(({theme:x})=>({position:"relative",display:"inline-flex",justifyContent:"center",alignItems:"center"}));function S({iconSize:x=1.6,textSize:o=.6,text:s="",iconProps:r={},countProps:j={}}){const v=T();return t.jsxs(ke,{children:[t.jsx(ve,{sx:{fontSize:x+"em",...r.sx},...r}),t.jsx(re,{component:"span",sx:{position:"absolute",lineHeight:1,color:v.palette.background.default,top:o*1.5+"em",fontSize:o+"em!important",...j.sx},...j,children:s})]})}function ze(){const x=le();T();const[o,s]=m.useState(!1),[r,j]=m.useState(!1),[v,P]=m.useState([]),[c,M]=m.useState({}),{auth:R}=m.useContext(ce),{showSnackbar:h}=ie(),w=m.useRef(null),{t:a}=de(),{productId:g}=me();if(!g){h(a("No product id specified"),"error"),x(-1);return}const D=()=>{w.current.click()},[L,N]=m.useState(!1),[y,U]=m.useState(null),[I,F]=m.useState(null),[l,i]=m.useState({});m.useEffect(()=>{R.user&&(async()=>{const e=await f("get","/product/getProductAllTypes");e.err?h(e.message,e.status===401?"warning":"error"):P(e.types)})()},[]);const V=e=>{e.target.files.length>1&&h(a("More than one image selected, using the first one"),"info");const n=e.target.files[0];n&&(U(n),F(URL.createObjectURL(n)),A(n.name))};m.useEffect(()=>{(async()=>{if(g==="<new>")console.log("NEW PRODUCT"),s({mdaCode:"",oemCode:"",make:"",models:[],application:"",kw:"",volt:"",ampere:"",teeth:"",rotation:"",regulator:"",type:"",imageNameOriginal:"",imageName:"",notes:""});else{const e=await f("get","/product/getProduct",{productId:g});e.err?h(e.message,e.status===401?"warning":"error"):(s(e.product),j(e.product))}})()},[g]),m.useEffect(()=>{L&&(N(!1),ae())},[L]);const W=e=>{s({...o,type:e}),i({...l,type:e!=r.type})},$=e=>{s({...o,mdaCode:e}),i({...l,mdaCode:e!=r.mdaCode})},B=e=>{s({...o,oemCode:e}),i({...l,oemCode:e!=r.oemCode})},G=e=>{s({...o,make:e}),i({...l,make:e!=r.make})},q=e=>{s({...o,models:e.split(", ")}),i({...l,models:e!=r.models})},K=e=>{s({...o,application:e}),i({...l,application:e!=r.application})},J=e=>{s({...o,kw:e}),i({...l,kw:e!=r.kw})},Q=e=>{s({...o,volt:e}),i({...l,volt:e!=r.volt})},X=e=>{s({...o,ampere:e}),i({...l,ampere:e!=r.ampere})},Y=e=>{s({...o,rotation:e}),i({...l,rotation:e!=r.rotation})},Z=e=>{s({...o,teeth:e}),i({...l,teeth:e!=r.teeth})},_=e=>{s({...o,regulator:e}),i({...l,regulator:e!=r.regulator})},ee=e=>{s({...o,notes:e}),i({...l,notes:e!=r.notes})},A=e=>{s({...o,imageNameOriginal:e}),i({...l,imageNameOriginal:e!=r.imageNameOriginal})},te=e=>{e.preventDefault(),N(!0),M({})},ae=async()=>{try{let e,n;if(g==="<new>"?(n=await f("post","/product/insertProduct",{product:o}),e=n.id):(n=await f("post","/product/updateProduct",{productId:g,product:o}),e=g),n.err)return h(n.message,"error");if(y){const b=new FormData;if(b.append("productId",e),b.append("image",y),n=await f("post","/product/uploadProductImage",b),n.err)return n.message==="Input buffer contains unsupported image format"&&(n.message=a("Image format unsupported")),h(n.message,"error")}x(-1)}catch(e){h(`An error occurred updating the product: ${e.message}`,"error"),console.error(e)}},oe=e=>{e.preventDefault(),M({}),x(-1)},d=e=>{const n={fontWeight:l[e]?"bold":"normal"};return{...n,input:n}};if(console.log("product.imageName:",o.imageName),o&&v.length)return t.jsxs(t.Fragment,{children:[t.jsx(pe,{text:a("Products handling"),children:a("Edit product")}),t.jsx(C,{sx:{display:"flex",justifyContent:"center",alignItems:"start",minHeight:"100vh"},children:t.jsxs(k,{container:!0,spacing:2,maxWidth:800,children:[t.jsx(k,{item:!0,xs:12,sm:6,children:t.jsx(C,{display:"flex",flexDirection:"column",gap:2,children:t.jsxs("form",{noValidate:!0,autoComplete:"off",children:[t.jsx(p,{autoFocus:!0,id:"mdaCode",label:a("MDA code"),value:o.mdaCode??"",onChange:e=>$(e.target.value),placeholder:a("MDA code"),startIcon:t.jsx(H,{}),error:c.mdaCode,sx:d("mdaCode")}),t.jsx(p,{id:"oemCode",label:a("OEM code"),value:o.oemCode??"",onChange:e=>B(e.target.value),placeholder:a("OEM code"),startIcon:t.jsx(H,{}),error:c.oemCode,sx:d("oemCode")}),t.jsx(ue,{id:"type",value:o.type??"",label:a("Type"),options:v,onChange:e=>W(e.target.value),placeholder:a("Type"),startIcon:t.jsx(be,{}),error:c.types,sx:d("type")}),t.jsx(p,{id:"make",label:a("Make"),value:o.make??"",onChange:e=>G(e.target.value),placeholder:a("Make"),startIcon:t.jsx(xe,{}),error:c.make,sx:d("make")}),t.jsx(p,{id:"models",label:a("Models"),value:o.models.join(", "),onChange:e=>q(e.target.value),placeholder:a("Models"),startIcon:t.jsx(ge,{}),error:c.models,sx:d("models")}),t.jsx(p,{id:"application",label:a("Application"),value:o.application??"",onChange:e=>K(e.target.value),placeholder:a("Application"),startIcon:t.jsx(he,{}),error:c.application,sx:d("application")}),t.jsx(p,{id:"kw",label:a("kW"),value:o.kw??"",onChange:e=>J(e.target.value),placeholder:a("kW"),startIcon:t.jsx(S,{text:"kW"}),error:c.kw,sx:d("kw")}),t.jsx(p,{id:"volt",label:a("Volt"),value:o.volt??"",onChange:e=>Q(e.target.value),placeholder:a("Volt"),startIcon:t.jsx(S,{text:"V"}),error:c.volt,sx:d("volt")}),t.jsx(p,{id:"ampere",label:a("Ampere"),value:o.ampere??"",onChange:e=>X(e.target.value),placeholder:a("Ampere"),startIcon:t.jsx(S,{text:"A"}),error:c.ampere,sx:d("ampere")}),t.jsx(p,{id:"rotation",label:a("Rotation"),value:o.rotation??"",onChange:e=>Y(e.target.value),placeholder:a("Rotation"),startIcon:t.jsx(Ie,{}),error:c.rotation,sx:d("rotation")}),t.jsx(p,{id:"teeth",label:a("Teeth"),value:o.teeth??"",onChange:e=>Z(e.target.value),placeholder:a("Teeth"),startIcon:t.jsx(ye,{}),error:c.teeth,sx:d("teeth")}),t.jsx(p,{id:"regulator",label:a("Regulator"),value:o.regulator??"",onChange:e=>_(e.target.value),placeholder:a("Regulator"),startIcon:t.jsx(Ce,{}),error:c.regulator,sx:d("regulator")}),t.jsx(p,{id:"notes",label:a("Notes"),value:o.notes??"",onChange:e=>ee(e.target.value),placeholder:a("Notes"),startIcon:t.jsx(fe,{}),multiline:!0,rows:2,error:c.notes,sx:d("notes"),spellCheck:!1}),t.jsx(p,{id:"image",label:a("Image"),value:o.imageNameOriginal??"",onChange:e=>A(e.target.value),placeholder:a("Image"),startIcon:t.jsx(je,{}),error:c.image,disabled:!0,sx:d("imageNameOriginal"),endIcon:t.jsxs(z,{id:"imageUpload",variant:"contained",component:"label",size:"small",sx:{position:"absolute",width:"auto",right:4,mt:-.8},children:[a("Choose"),t.jsx("input",{type:"file",hidden:!0,onChange:V})]})})]})})}),t.jsx(k,{item:!0,xs:12,sm:6,children:t.jsxs(C,{display:"flex",flexDirection:"column",gap:2,alignItems:"center",justifyContent:"space-between",sx:{height:"100%"},children:[t.jsxs(C,{display:"flex",flexDirection:"column",gap:1,mt:{xs:-1,sm:1},alignItems:"center",flexGrow:1,children:[t.jsx("input",{type:"file",hidden:!0,ref:w,onChange:V}),t.jsx("div",{onClick:D,style:{cursor:"pointer"},children:t.jsx(E,{src:o.imageName?`${O.siteUrl}${O.images.publicPathWaterMark}/${o.imageName}`:void 0,alt:a("Current image"),borderColor:"primary.main",backgroundColor:"background.default",label:r.imageNameOriginal})}),I&&t.jsx(E,{src:I,alt:a("Image being uploaded"),borderColor:"primary.main",backgroundColor:"background.default",label:y.name},I)]}),t.jsxs(C,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2,mb:.5},children:[t.jsx(z,{onClick:te,variant:"contained",color:"success",size:"large",children:a("Confirm")}),t.jsx(z,{onClick:oe,variant:"contained",color:"secondary",size:"small",children:a("Cancel")})]})]})})]})})]})}const Ve=ne.memo(ze);export{Ve as default};
