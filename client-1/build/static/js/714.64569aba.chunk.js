"use strict";(self.webpackChunkacme_client=self.webpackChunkacme_client||[]).push([[714],{4714:(e,s,l)=>{l.r(s),l.d(s,{default:()=>F});var t=l(402),a=l(7282),r=l(1619),n=l(7758),o=l(4391),c=l(2737),i=l(5649),d=l(5121),u=l(3481),m=l(9103),h=l(8058);const g=function(e){let{open:s,onClose:l,onConfirm:t,title:a,message:r,confirmText:n,cancelText:g}=e;return(0,h.jsxs)(o.A,{open:s,onClose:l,children:[(0,h.jsx)(c.A,{children:a}),(0,h.jsx)(i.A,{children:(0,h.jsx)(d.A,{children:r})}),(0,h.jsxs)(u.A,{children:[(0,h.jsx)(m.A,{onClick:l,color:"secondary",children:g}),(0,h.jsx)(m.A,{onClick:t,color:"success",children:n})]})]})};var x=l(3567),b=l(9333),C=l(9785),j=l(2704);const A=function(e){let{open:s,onClose:l,onConfirm:a}=e;const{t:n}=(0,r.B)(),[m,g]=(0,t.useState)(""),[A,p]=(0,t.useState)(""),[k,f]=(0,t.useState)({}),v=()=>{g(""),p("")};return(0,h.jsxs)(o.A,{open:s,onClose:l,fullWidth:!0,maxWidth:"sm",children:[(0,h.jsx)(c.A,{children:n("Create email")}),(0,h.jsx)(i.A,{children:(0,h.jsxs)(d.A,{children:[(0,h.jsx)(C.ZQ,{autoFocus:!0,id:"subject",value:m,onChange:e=>g(e.target.value),placeholder:n("Subject"),startAdornmentIcon:(0,h.jsx)(b.A,{}),error:k.subject}),(0,h.jsx)(x.A,{m:0}),(0,h.jsx)(C.ZQ,{id:"body",value:A,onChange:e=>p(e.target.value),placeholder:n("Body"),error:k.body,multiline:!0,rows:4,maxRows:1/0}),(0,h.jsx)(x.A,{m:0})]})}),(0,h.jsxs)(u.A,{children:[(0,h.jsx)(C.pr,{onClick:e=>{l(),v()},color:"secondary",children:n("Cancel")}),(0,h.jsx)(C.pr,{onClick:e=>{e.preventDefault(),(()=>{if(!m){let e=n("Please supply an email subject");return f({subject:e}),j.o.warning(e),!1}if(!A){let e=n("Please supply an email body");return f({body:e}),j.o.warning(e),!1}return!0})()&&(f({}),a({subject:m,body:A}),v())},color:"primary",children:n("Send email to selected users")})]})]})};var p=l(9446),k=l.n(p),f=(l(1030),l(2335)),v=l(8913),$=l(3232),N=l(8643),w=l(4173),y=l(8149),B=l(29),S=l(6101),E=l(1363),H=l(1965),P=l(1831),L=l(4153),I=l(5937),_=l(39),O=l(8625),R=l(2413),T=l(242);const z=(0,n.A)((e=>({root:{"& .MuiTableCell-head":{color:e.palette.header.color,backgroundColor:e.palette.header.backgroundColor}},outlinedInput:{"& $notchedOutline":{borderColor:"lightgray"},"&$focused $notchedOutline":{borderColor:"blue"}},notchedOutline:{},focused:{},table:{fontSize:"0.9em",minWidth:650},tableContainer:{maxHeight:440},tableHeader:{backgroundColor:e.palette.background.default,position:"sticky",top:0,zIndex:1},tableCell:{padding:"2px 16px"},actionsCell:{whiteSpace:"nowrap"},headerCheckbox:{paddingLeft:"20px"},title:{padding:8,paddingRight:24,borderRadius:4,textAlign:"right",color:e.palette.title.color,backgroundColor:e.palette.title.backgroundColor},filter:{padding:2,textAlign:"right"},sortButton:{marginLeft:12},sortButtonActive:{opacity:"80%"},sortButtonInactive:{opacity:"40%"},bulkButton:{marginRight:8},removeButton:{backgroundColor:e.palette.danger.backgroundColor}}))),U=()=>{const e=z(),s=(0,a.W6)(),{t:l}=(0,r.B)(),[n,o]=(0,t.useState)([]),[c,i]=(0,t.useState)("");(0,t.useEffect)((()=>{(0,f.lo)({}).then((e=>{if(!e.ok)return console.warn("getUsers error:",e),void(e.message&&j.o.error(l(e.message)));o(e.users),console.log("getUsers success:",e)}))}),[l]);k().locale("it");const[d,u]=(0,t.useState)(0),[b,p]=(0,t.useState)(5),[U,F]=(0,t.useState)([]),W=(e,s,t)=>{switch(s){case"removeBulk":(async(e,s)=>{(0,f.a1)({filter:e,...s}).then((s=>{if(!s.ok)return console.warn("removeUser error:",s),void(s.message&&j.o.error(s.message));o((s=>s.filter((s=>!e.includes(s._id)))))})).catch((s=>{console.error(`Error bulk deleting users with ids ${e}: ${s.message}`),j.o.error(`${l("Error bulk deleting users with ids")} ${e}: ${s.message}`)}))})(e);break;case"emailBulk":(async(e,s)=>{(0,f.Un)({filter:e,...s}).then((s=>{if(!s.ok)return console.warn("sendEmailToUsers error:",s),void(s.message&&j.o.error(s.message));j.o.success(l("Email sent to {{count}} selected users",{count:e.length}))})).catch((s=>{console.error(`Error bulk sending email to users with ids ${e}: ${s.message}`),j.o.error(`${l("Error bulk sending email to users with ids")} ${e}: ${s.message}`)}))})(e,t);break;default:alert("unforeseen bulk action "+e.join(", ")+" "+s)}},[D,M]=(0,t.useState)("lastName"),[Q,Z]=(0,t.useState)("asc"),q=e=>()=>{let s="asc";D===e&&"asc"===Q&&(s="desc"),M(e),Z(s)},[G,J]=(0,t.useState)(""),[K,V]=(0,t.useState)(!1),X=()=>{V(!1),J("")},[Y,ee]=(0,t.useState)(!1),se=()=>{ee(!1),J("")},le=t.useMemo((()=>{let e=[...n];return null!==D&&e.sort(((e,s)=>{var l,t;let a=null===(l=e[D])||void 0===l?void 0:l.toLowerCase(),r=null===(t=s[D])||void 0===t?void 0:t.toLowerCase();return a<r?"asc"===Q?-1:1:a>r?"asc"===Q?1:-1:0})),e}),[n,D,Q]),te=s=>(0,h.jsx)(v.A,{component:"span",className:[e.sortButton,D===s.column?e.sortButtonActive:e.sortButtonInactive],children:D===s.column?"asc"===Q?"\u25bc":"\u25b2":"\u25a2"});return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(C.zE,{children:l("Users handling")}),(0,h.jsx)(x.A,{sx:{marginBottom:8},className:e.filter,children:(0,h.jsx)($.A,{label:l("Filter users"),value:c,onChange:e=>{i(e.target.value)},variant:"outlined",InputLabelProps:{shrink:!0},InputProps:{startAdornment:(0,h.jsx)(N.A,{position:"end",children:(0,h.jsx)(O.A,{})}),classes:{root:e.outlinedInput,notchedOutline:e.notchedOutline}},sx:{marginLeft:"auto",marginRight:2}})}),(0,h.jsxs)(w.A,{children:[(0,h.jsx)(y.A,{className:[e.root,e.tableContainer],children:(0,h.jsxs)(B.A,{stickyHeader:!0,className:e.table,children:[(0,h.jsx)(S.A,{children:(0,h.jsxs)(E.A,{children:[(0,h.jsx)(H.A,{padding:"checkbox",className:e.tableHeader,children:(0,h.jsx)(P.A,{indeterminate:U.length>0&&U.length<n.length,checked:n.length>0&&U.length===n.length,onChange:e=>{if(e.target.checked){const e=n.map((e=>e._id));F(e)}else F([])},className:e.headerCheckbox})}),(0,h.jsxs)(H.A,{className:`${e.tableHeader} ${e.tableCell}`,onClick:q("firstName"),children:[l("First name")," ",te({column:"firstName"})]}),(0,h.jsxs)(H.A,{className:`${e.tableHeader} ${e.tableCell}`,onClick:q("lastName"),children:[l("Last name")," ",te({column:"lastName"})]}),(0,h.jsxs)(H.A,{className:`${e.tableHeader} ${e.tableCell}`,onClick:q("email"),children:[l("Email")," ",te({column:"email"})]}),(0,h.jsx)(H.A,{className:`${e.tableHeader} ${e.tableCell}`,children:l("Phone")}),(0,h.jsx)(H.A,{className:`${e.tableHeader} ${e.tableCell}`,children:l("Roles")}),(0,h.jsx)(H.A,{className:`${e.tableHeader} ${e.tableCell}`,children:l("Fiscal Code")}),(0,h.jsxs)(H.A,{className:`${e.tableHeader} ${e.tableCell}`,onClick:q("businessName"),children:[l("Business name")," ",te({column:"businessName"})]}),(0,h.jsx)(H.A,{className:`${e.tableHeader} ${e.tableCell}`,children:l("Actions")})]})}),(0,h.jsx)(L.A,{children:le.filter((e=>e.firstName.toLowerCase().includes(c.toLowerCase()))).slice(d*b,d*b+b).map((t=>{const a=(r=t._id,-1!==U.indexOf(r));var r;return(0,h.jsxs)(E.A,{hover:!0,onClick:e=>((e,s)=>{const l=U.indexOf(s);let t=[];-1===l?t=t.concat(U,s):0===l?t=t.concat(U.slice(1)):l===U.length-1?t=t.concat(U.slice(0,-1)):l>0&&(t=t.concat(U.slice(0,l),U.slice(l+1))),F(t)})(0,t._id),role:"checkbox","aria-checked":a,tabIndex:-1,selected:a,children:[(0,h.jsx)(H.A,{padding:"checkbox",className:e.tableCell,children:(0,h.jsx)(P.A,{checked:a})}),(0,h.jsx)(H.A,{className:e.tableCell,children:t.firstName}),(0,h.jsx)(H.A,{className:e.tableCell,children:t.lastName}),(0,h.jsx)(H.A,{className:e.tableCell,children:t.email}),(0,h.jsx)(H.A,{className:e.tableCell,children:t.phone}),(0,h.jsx)(H.A,{className:e.tableCell,children:t.roles.sort(((e,s)=>e.priority<s.priority)).map((e=>e.name)).join(", ")}),(0,h.jsx)(H.A,{className:e.tableCell,children:t.fiscalCode}),(0,h.jsx)(H.A,{className:e.tableCell,children:t.businessName}),(0,h.jsxs)(H.A,{className:`${e.tableCell} ${e.actionsCell}`,children:[(0,h.jsx)(I.A,{size:"small",onClick:()=>{return e=t._id,void s.push(`/edit-user/${e}`);var e},children:(0,h.jsx)(R.A,{fontSize:"small"})}),(0,h.jsx)(I.A,{size:"small",onClick:()=>(async e=>{(0,f.a1)({filter:[e]}).then((s=>{if(!s.ok)return console.warn("removeUser error:",s),void(s.message&&j.o.error(l(s.message)));o((s=>s.filter((s=>s._id!==e))))})).catch((s=>{console.error(`Error deleting user with id ${e}: ${s.message}`),j.o.error(`${l("Error deleting user with id")} ${e}: ${s.message}`)}))})(t._id),children:(0,h.jsx)(T.A,{fontSize:"small"})})]})]},t._id)}))})]})}),(0,h.jsx)(_.A,{rowsPerPageOptions:[5,10,25],component:"div",count:n.length,rowsPerPage:b,page:d,onPageChange:(e,s)=>{u(s)},onRowsPerPageChange:e=>{p(parseInt(e.target.value,10)),u(0)}}),(0,h.jsxs)(x.A,{sx:{padding:8},children:[(0,h.jsx)(m.A,{variant:"contained",color:"secondary",className:[e.bulkButton],onClick:()=>(e=>{J(e),ee(!0)})("emailBulk"),disabled:0===U.length,children:l("Email selected users")}),(0,h.jsx)(m.A,{variant:"contained",color:"primary",className:[e.bulkButton,e.removeButton],onClick:()=>(e=>{J(e),V(!0)})("removeBulk"),disabled:0===U.length,children:l("Remove selected users")})]})]}),(0,h.jsx)(g,{open:K,onClose:X,onConfirm:()=>{W(U,G),X()},title:l("Confirm Delete"),message:l("Are you sure you want to delete all the {{count}} selected users?",{count:U.length}),confirmText:l("Confirm"),cancelText:l("Cancel")}),(0,h.jsx)(A,{open:Y,onClose:se,onConfirm:e=>{W(U,G,e),se()},title:l("Create email"),subjectLabel:l("Subject"),bodyLabel:l("Body"),confirmText:l("Send email to selected users"),cancelText:l("Cancel")})]})},F=t.memo(U)}}]);
//# sourceMappingURL=714.64569aba.chunk.js.map